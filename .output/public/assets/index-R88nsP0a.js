import{a as F,r as w,V as l,o as q,j as e,n as L,s as g}from"./index-BzBvWqhX.js";import{L as E,M as Q,X as R}from"./Layout-DHUNYKTw.js";import{u as U}from"./auth-DP1CS8M1.js";import{u as S,a as $,b as z,C as k,d as G}from"./zod-_sgmqnks.js";import{u as y}from"./useMutation-Cv5Pj69L.js";import{P as X}from"./plus-B6KoFE6S.js";import{S as B,T as H}from"./trash-2-BHh47ZHs.js";const J=q({eventName:g().min(1,"Event name is required"),startDate:g().min(1,"Start date is required"),endDate:g().min(1,"End date is required"),eventDetails:g().optional(),venueId:L().min(1,"Please select a venue")}),ae=function(){const{token:a,user:u}=U(),d=F(),[C,r]=w.useState(!1),[h,j]=w.useState(null),n=S(d.getEvents.queryOptions({authToken:a})),A=S(d.getVenues.queryOptions({authToken:a})),b=y(d.createEvent.mutationOptions({onSuccess:()=>{l.success("Event created successfully"),r(!1),v(),n.refetch()},onError:t=>{l.error(t.message||"Failed to create event")}})),f=y(d.updateEvent.mutationOptions({onSuccess:()=>{l.success("Event updated successfully"),r(!1),j(null),v(),n.refetch()},onError:t=>{l.error(t.message||"Failed to update event")}})),M=y(d.deleteEvent.mutationOptions({onSuccess:()=>{l.success("Event deleted successfully"),n.refetch()},onError:t=>{l.error(t.message||"Failed to delete event")}})),{register:i,handleSubmit:P,formState:{errors:s},reset:v,setValue:c}=$({resolver:z(J)});if(!u||!a)return e.jsx(E,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Please log in to access this page."})]})});const N=()=>{j(null),v(),r(!0)},I=t=>{j(t),c("eventName",t.eventName),c("startDate",new Date(t.startDate).toISOString().slice(0,10)),c("endDate",new Date(t.endDate).toISOString().slice(0,10)),c("eventDetails",t.eventDetails||""),c("venueId",t.venueId),r(!0)},T=async t=>{try{h?await f.mutateAsync({authToken:a,eventId:h.id,...t,startDate:t.startDate,endDate:t.endDate}):await b.mutateAsync({authToken:a,...t,startDate:t.startDate,endDate:t.endDate})}catch{}},O=async t=>{window.confirm("Are you sure you want to delete this event? This will also delete all associated sessions and registrations.")&&await M.mutateAsync({authToken:a,eventId:t})},D=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),V=(t,o)=>{const m=new Date,x=new Date(t),p=new Date(o);return m<x?{status:"upcoming",color:"bg-blue-100 text-blue-800"}:m>=x&&m<=p?{status:"ongoing",color:"bg-green-100 text-green-800"}:{status:"completed",color:"bg-gray-100 text-gray-800"}};return e.jsx(E,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Event Management"}),u.role==="ADMIN"&&e.jsxs("button",{onClick:N,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md flex items-center",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Add Event"]})]}),n.isLoading?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading events..."})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:n.data?.map(t=>{const o=V(t.startDate,t.endDate),m=t.expenses?.reduce((x,p)=>p.status==="APPROVED"?x+p.amount:x,0)||0;return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"h-5 w-5 text-red-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.eventName})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${o.color}`,children:o.status}),u.role==="ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>I(t),className:"text-blue-600 hover:text-blue-900",children:e.jsx(B,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>O(t.id),className:"text-red-600 hover:text-red-900",children:e.jsx(H,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),e.jsxs("span",{children:[D(t.startDate)," - ",D(t.endDate)]})]}),e.jsxs("div",{className:"flex items-start text-sm text-gray-600",children:[e.jsx(Q,{className:"h-4 w-4 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Venue #",t.venue.id]}),e.jsx("p",{className:"text-xs",children:t.venue.venueAddress}),e.jsxs("p",{className:"text-xs",children:["Capacity: ",t.venue.venueCapacity]})]})]}),t.eventDetails&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Details:"}),e.jsx("p",{className:"text-sm text-gray-600",children:t.eventDetails})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-3 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Sessions"}),e.jsx("p",{className:"text-lg font-bold text-red-600",children:t.sessions?.length||0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Expenses"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:["$",m.toFixed(2)]})]})]})]})]},t.id)})}),n.data?.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No events found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Get started by creating your first event."}),u.role==="ADMIN"&&e.jsx("button",{onClick:N,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md",children:"Add Event"})]}),C&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:h?"Edit Event":"Create Event"}),e.jsx("button",{onClick:()=>r(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(R,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:P(T),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Event Name *"}),e.jsx("input",{...i("eventName"),type:"text",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500",placeholder:"Enter event name..."}),s.eventName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.eventName.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Venue *"}),e.jsxs("select",{...i("venueId",{valueAsNumber:!0}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"",children:"Select a venue..."}),A.data?.map(t=>e.jsxs("option",{value:t.id,children:["Venue #",t.id," - ",t.venueAddress.split(",")[0]]},t.id))]}),s.venueId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.venueId.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Start Date *"}),e.jsx("input",{...i("startDate"),type:"date",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500"}),s.startDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.startDate.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"End Date *"}),e.jsx("input",{...i("endDate"),type:"date",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500"}),s.endDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.endDate.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Event Details"}),e.jsx("textarea",{...i("eventDetails"),rows:3,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500",placeholder:"Enter event details..."}),s.eventDetails&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.eventDetails.message})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:b.isPending||f.isPending,className:"px-4 py-2 bg-red-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-red-700 disabled:opacity-50",children:b.isPending||f.isPending?"Saving...":h?"Update":"Create"})]})]})]})})]})})};export{ae as component};
