import{a as q,r as f,V as o,o as L,j as e,n as D,s as m}from"./index-BzBvWqhX.js";import{L as C,M as R,X as U}from"./Layout-DHUNYKTw.js";import{u as $}from"./auth-DP1CS8M1.js";import{u as T,a as Q,b as V,d as j,C as z,U as G}from"./zod-_sgmqnks.js";import{u as N}from"./useMutation-Cv5Pj69L.js";import{P as X}from"./plus-B6KoFE6S.js";import{S as H,T as J}from"./trash-2-BHh47ZHs.js";const K=L({sessionName:m().min(1,"Session name is required"),sessionDate:m().min(1,"Session date is required"),startTime:m().min(1,"Start time is required"),endTime:m().min(1,"End time is required"),sessionDetails:m().optional(),sessionBalanceCapacity:D().min(1,"Capacity must be at least 1"),eventId:D().min(1,"Please select an event")}),ne=function(){const{token:n,user:x}=$(),d=q(),[k,l]=f.useState(!1),[u,h]=f.useState(null),[p,E]=f.useState(null),i=T(d.getSessions.queryOptions({authToken:n,eventId:p||void 0})),v=T(d.getEvents.queryOptions({authToken:n})),g=N(d.createSession.mutationOptions({onSuccess:()=>{o.success("Session created successfully"),l(!1),y(),i.refetch()},onError:s=>{o.error(s.message||"Failed to create session")}})),b=N(d.updateSession.mutationOptions({onSuccess:()=>{o.success("Session updated successfully"),l(!1),h(null),y(),i.refetch()},onError:s=>{o.error(s.message||"Failed to update session")}})),I=N(d.deleteSession.mutationOptions({onSuccess:()=>{o.success("Session deleted successfully"),i.refetch()},onError:s=>{o.error(s.message||"Failed to delete session")}})),{register:a,handleSubmit:A,formState:{errors:t},reset:y,setValue:r}=Q({resolver:V(K)});if(!x||!n)return e.jsx(C,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Please log in to access this page."})]})});const S=()=>{h(null),y(),l(!0)},M=s=>{h(s),r("sessionName",s.sessionName),r("sessionDate",new Date(s.sessionDate).toISOString().slice(0,10)),r("startTime",s.startTime),r("endTime",s.endTime),r("sessionDetails",s.sessionDetails||""),r("sessionBalanceCapacity",s.sessionBalanceCapacity),r("eventId",s.eventId),l(!0)},F=async s=>{try{u?await b.mutateAsync({authToken:n,sessionId:u.id,...s,sessionDate:new Date(s.sessionDate).toISOString()}):await g.mutateAsync({authToken:n,...s,sessionDate:new Date(s.sessionDate).toISOString()})}catch{}},P=async s=>{window.confirm("Are you sure you want to delete this session?")&&await I.mutateAsync({authToken:n,sessionId:s})},O=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),w=s=>s,B=s=>{const c=new Date;return new Date(s)>c?{status:"upcoming",color:"bg-blue-100 text-blue-800"}:{status:"completed",color:"bg-gray-100 text-gray-800"}};return e.jsx(C,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Session Management"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{value:p||"",onChange:s=>E(s.target.value?Number(s.target.value):null),className:"border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"",children:"All Events"}),v.data?.map(s=>e.jsx("option",{value:s.id,children:s.eventName},s.id))]}),x.role==="ADMIN"&&e.jsxs("button",{onClick:S,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md flex items-center",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Add Session"]})]})]}),i.isLoading?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading sessions..."})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:i.data?.map(s=>{const c=B(s.sessionDate);return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{className:"h-5 w-5 text-red-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.sessionName})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${c.color}`,children:c.status}),x.role==="ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>M(s),className:"text-blue-600 hover:text-blue-900",children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>P(s.id),className:"text-red-600 hover:text-red-900",children:e.jsx(J,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:O(s.sessionDate)})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),e.jsxs("span",{children:[w(s.startTime)," - ",w(s.endTime)]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:s.event.eventName})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),e.jsxs("span",{children:["Capacity: ",s.currentRegistrations,"/",s.sessionBalanceCapacity,s.isFull&&e.jsx("span",{className:"text-red-600 font-medium ml-1",children:"(FULL)"})]})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 mr-2",children:e.jsx("div",{className:`h-2 rounded-full ${s.isFull?"bg-red-500":s.availableSpots<=5?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(s.currentRegistrations/s.sessionBalanceCapacity*100,100)}%`}})}),e.jsxs("span",{className:`text-xs font-medium ${s.isFull?"text-red-600":s.availableSpots<=5?"text-yellow-600":"text-green-600"}`,children:[s.availableSpots," available"]})]}),s.sessionDetails&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Details:"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.sessionDetails})]}),e.jsxs("div",{className:"pt-3 border-t space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Products Available"}),e.jsx("p",{className:"text-sm font-bold text-blue-600",children:s.productSessionMaps?.length||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Registration Status"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold text-gray-900",children:[s.currentRegistrations," / ",s.sessionBalanceCapacity]}),e.jsx("p",{className:`text-xs ${s.isFull?"text-red-600":s.availableSpots<=5?"text-yellow-600":"text-green-600"}`,children:s.isFull?"Full":s.availableSpots<=5?"Nearly Full":"Available"})]})]})]})]})]},s.id)})}),i.data?.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(j,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No sessions found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:p?"No sessions found for the selected event.":"Get started by creating your first session."}),x.role==="ADMIN"&&e.jsx("button",{onClick:S,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md",children:"Add Session"})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:u?"Edit Session":"Create Session"}),e.jsx("button",{onClick:()=>l(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(U,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:A(F),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Session Name *"}),e.jsx("input",{...a("sessionName"),type:"text",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500",placeholder:"Enter session name..."}),t.sessionName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.sessionName.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Event *"}),e.jsxs("select",{...a("eventId",{valueAsNumber:!0}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"",children:"Select an event..."}),v.data?.map(s=>e.jsx("option",{value:s.id,children:s.eventName},s.id))]}),t.eventId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.eventId.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Session Date *"}),e.jsx("input",{...a("sessionDate"),type:"date",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500"}),t.sessionDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.sessionDate.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Start Time *"}),e.jsx("input",{...a("startTime"),type:"time",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500"}),t.startTime&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.startTime.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"End Time *"}),e.jsx("input",{...a("endTime"),type:"time",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500"}),t.endTime&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.endTime.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Capacity *"}),e.jsx("input",{...a("sessionBalanceCapacity",{valueAsNumber:!0}),type:"number",min:"1",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500",placeholder:"Enter capacity..."}),t.sessionBalanceCapacity&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.sessionBalanceCapacity.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Session Details"}),e.jsx("textarea",{...a("sessionDetails"),rows:3,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500",placeholder:"Enter session details..."}),t.sessionDetails&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.sessionDetails.message})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>l(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:g.isPending||b.isPending,className:"px-4 py-2 bg-red-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-red-700 disabled:opacity-50",children:g.isPending||b.isPending?"Saving...":u?"Update":"Create"})]})]})]})})]})})};export{ne as component};
