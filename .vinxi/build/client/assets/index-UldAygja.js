import{r as i,j as e,a as Q,V as o,o as B,n as U,s as A}from"./index-BzBvWqhX.js";import{L as D,R as T,X}from"./Layout-DHUNYKTw.js";import{F as R,D as _,a as H}from"./file-text-5vL03K5q.js";import{u as K}from"./auth-DP1CS8M1.js";import{e as W,u as P,a as Y,b as Z,C as ee,d as se}from"./zod-_sgmqnks.js";import{u as w}from"./useMutation-Cv5Pj69L.js";import{P as te}from"./plus-B6KoFE6S.js";import{U as re}from"./user-C54GR3IX.js";import{C as ae}from"./check-Dt4IKMKD.js";/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],le=W("circle-x",ne);function oe({fileName:m,displayName:r,className:x=""}){const[n,h]=i.useState(!1),d=async()=>{if(m){h(!0);try{const c=`http://localhost:9000/expense-receipts/${m}`,f=await fetch(c);if(!f.ok)throw new Error("File not found");const u=await f.blob(),b=window.URL.createObjectURL(u),a=document.createElement("a");a.href=b,a.download=r||m,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(b)}catch(c){console.error("Download failed:",c)}finally{h(!1)}}};return m?e.jsx("button",{onClick:d,disabled:n,className:`inline-flex items-center text-blue-600 hover:text-blue-800 text-sm ${x}`,children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),r||"View Receipt"]})}):e.jsx("span",{className:"text-gray-400 text-sm",children:"No receipt attached"})}const ce=B({expenseType:A().min(1,"Expense type is required"),vendor:A().min(1,"Vendor is required"),amount:U().min(.01,"Amount must be greater than 0"),eventId:U().min(1,"Please select an event")}),ye=function(){const{token:r,user:x}=K(),n=Q(),[h,d]=i.useState(!1),[c,f]=i.useState(null),[u,b]=i.useState(""),[a,g]=i.useState(!1),[E,N]=i.useState(""),p=P(n.getExpenses.queryOptions({authToken:r,eventId:c||void 0,status:u||void 0})),k=P(n.getEvents.queryOptions({authToken:r})),v=w(n.createExpense.mutationOptions({onSuccess:()=>{o.success("Expense created successfully"),d(!1),S(),N(""),p.refetch()},onError:s=>{o.error(s.message||"Failed to create expense")}})),I=w(n.updateExpenseStatus.mutationOptions({onSuccess:()=>{o.success("Expense status updated successfully"),p.refetch()},onError:s=>{o.error(s.message||"Failed to update expense status")}})),L=w(n.getPresignedUrlForUpload.mutationOptions({onSuccess:async s=>{try{const j=document.querySelector('input[type="file"]')?.files?.[0];if(!j)throw new Error("No file selected");if((await fetch(s.presignedUrl,{method:"PUT",body:j,headers:{"Content-Type":j.type}})).ok){const G=`${s.bucketName}/${s.objectName}`;N(G),o.success("File uploaded successfully")}else throw new Error("Upload failed")}catch{o.error("Failed to upload file")}finally{g(!1)}},onError:s=>{o.error(s.message||"Failed to get upload URL"),g(!1)}})),{register:y,handleSubmit:O,formState:{errors:l},reset:S}=Y({resolver:Z(ce)});if(!x||!r)return e.jsx(D,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Please log in to access this page."})]})});const C=()=>{S(),N(""),d(!0)},M=async s=>{try{await v.mutateAsync({authToken:r,...s,receiptFile:E||void 0})}catch{}},V=async s=>{const t=s.target.files?.[0];if(t){if(t.size>10*1024*1024){o.error("File size must be less than 10MB");return}g(!0);try{await L.mutateAsync({authToken:r,fileName:t.name,fileType:t.type})}catch{g(!1)}}},F=async(s,t)=>{window.confirm(`Are you sure you want to ${t.toLowerCase()} this expense?`)&&await I.mutateAsync({authToken:r,expenseId:s,status:t})},q=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),$=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s),z=s=>{switch(s){case"APPROVED":return"bg-green-100 text-green-800";case"REJECTED":return"bg-red-100 text-red-800";default:return"bg-yellow-100 text-yellow-800"}},J=s=>{switch(s){case"APPROVED":return e.jsx(ae,{className:"h-4 w-4"});case"REJECTED":return e.jsx(le,{className:"h-4 w-4"});default:return e.jsx(se,{className:"h-4 w-4"})}};return e.jsx(D,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Expense Management"}),e.jsxs("button",{onClick:C,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md flex items-center",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Add Expense"]})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Filter by Event"}),e.jsxs("select",{value:c||"",onChange:s=>f(s.target.value?Number(s.target.value):null),className:"border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"",children:"All Events"}),k.data?.map(s=>e.jsx("option",{value:s.id,children:s.eventName},s.id))]})]}),x.role==="ADMIN"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Filter by Status"}),e.jsxs("select",{value:u,onChange:s=>b(s.target.value),className:"border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"APPROVED",children:"Approved"}),e.jsx("option",{value:"REJECTED",children:"Rejected"})]})]})]})}),p.isLoading?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading expenses..."})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:p.data?.map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{className:"h-5 w-5 text-red-600 mr-2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.expenseType}),e.jsx("p",{className:"text-sm text-gray-500",children:s.vendor})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${z(s.status)}`,children:[J(s.status),e.jsx("span",{className:"ml-1",children:s.status})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"font-semibold text-green-600",children:$(s.amount)})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:q(s.createdAt)})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:s.member.memberName})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:s.event.eventName})]}),s.receiptFile&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),e.jsx(oe,{fileName:s.receiptFile.split("/").pop()||"",displayName:"View Receipt"})]}),x.role==="ADMIN"&&s.status==="PENDING"&&e.jsxs("div",{className:"pt-3 border-t",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Admin Actions"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>F(s.id,"APPROVED"),className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm",children:"Approve"}),e.jsx("button",{onClick:()=>F(s.id,"REJECTED"),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm",children:"Reject"})]})]})]})]},s.id))}),p.data?.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(T,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No expenses found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:c||u?"No expenses match your current filters.":"Get started by adding your first expense."}),e.jsx("button",{onClick:C,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md",children:"Add Expense"})]}),h&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Create Expense"}),e.jsx("button",{onClick:()=>d(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(X,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:O(M),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Expense Type *"}),e.jsx("input",{...y("expenseType"),type:"text",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500",placeholder:"e.g., Food, Transportation, Supplies..."}),l.expenseType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.expenseType.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Vendor *"}),e.jsx("input",{...y("vendor"),type:"text",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500",placeholder:"Enter vendor name..."}),l.vendor&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.vendor.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Amount *"}),e.jsx("input",{...y("amount",{valueAsNumber:!0}),type:"number",step:"0.01",min:"0",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500",placeholder:"0.00"}),l.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.amount.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Event *"}),e.jsxs("select",{...y("eventId",{valueAsNumber:!0}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"",children:"Select an event..."}),k.data?.map(s=>e.jsx("option",{value:s.id,children:s.eventName},s.id))]}),l.eventId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.eventId.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Receipt File"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:V,disabled:a,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-50 file:text-red-700 hover:file:bg-red-100"}),a&&e.jsx("p",{className:"mt-2 text-sm text-blue-600",children:"Uploading file..."}),E&&e.jsx("p",{className:"mt-2 text-sm text-green-600",children:"✓ File uploaded successfully"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Upload a receipt image or PDF (max 10MB)"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:v.isPending||a,className:"px-4 py-2 bg-red-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-red-700 disabled:opacity-50",children:v.isPending?"Creating...":"Create Expense"})]})]})]})})]})})};export{ye as component};
