import{a as A,r as y,V as d,o as M,j as e,e as S,s as c,n as u}from"./index-BzBvWqhX.js";import{L as j,X as C}from"./Layout-DHUNYKTw.js";import{u as T}from"./auth-DP1CS8M1.js";import{u as I,a as D,b as F}from"./zod-_sgmqnks.js";import{u as f}from"./useMutation-Cv5Pj69L.js";import{P as O}from"./plus-B6KoFE6S.js";import{S as L,T as R}from"./trash-2-BHh47ZHs.js";const q=M({memberName:c().min(1,"Name is required"),memberEmail:c().email("Invalid email address"),memberPhone:c().optional(),adults:u().min(1,"At least 1 adult required"),children:u().min(0),infants:u().min(0),elder:u().min(0),password:c().min(6,"Password must be at least 6 characters"),role:S(["ADMIN","MEMBER"])}),J=function(){const{token:o,user:N}=T(),i=A(),[g,l]=y.useState(!1),[m,x]=y.useState(null),n=I(i.getUsers.queryOptions({authToken:o})),b=f(i.createUser.mutationOptions({onSuccess:()=>{d.success("User created successfully"),l(!1),p(),n.refetch()},onError:s=>{d.error(s.message||"Failed to create user")}})),h=f(i.updateUser.mutationOptions({onSuccess:()=>{d.success("User updated successfully"),l(!1),x(null),p(),n.refetch()},onError:s=>{d.error(s.message||"Failed to update user")}})),v=f(i.deleteUser.mutationOptions({onSuccess:()=>{d.success("User deleted successfully"),n.refetch()},onError:s=>{d.error(s.message||"Failed to delete user")}})),{register:t,handleSubmit:w,formState:{errors:r},reset:p,setValue:a}=D({resolver:F(q)});if(N?.role!=="ADMIN")return e.jsx(j,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"You don't have permission to access this page."})]})});const k=()=>{x(null),p(),l(!0)},P=s=>{x(s),a("memberName",s.member?.memberName||""),a("memberEmail",s.email),a("memberPhone",s.member?.memberPhone||""),a("adults",s.member?.adults||1),a("children",s.member?.children||0),a("infants",s.member?.infants||0),a("elder",s.member?.elder||0),a("role",s.role),a("password",""),l(!0)},E=async s=>{try{m?await h.mutateAsync({authToken:o,userId:m.id,...s,password:s.password||void 0}):await b.mutateAsync({authToken:o,...s})}catch{}},U=async s=>{window.confirm("Are you sure you want to delete this user?")&&await v.mutateAsync({authToken:o,userId:s})};return e.jsx(j,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),e.jsxs("button",{onClick:k,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Add User"]})]}),n.isLoading?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading users..."})]}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:n.data?.map(s=>e.jsx("li",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.member?.memberName||"No Name"}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),s.member?.memberPhone&&e.jsx("p",{className:"text-sm text-gray-500",children:s.member.memberPhone})]}),e.jsx("div",{className:"ml-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.role==="ADMIN"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:s.role})})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>P(s),className:"text-blue-600 hover:text-blue-900",children:e.jsx(L,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>U(s.id),className:"text-red-600 hover:text-red-900",children:e.jsx(R,{className:"h-4 w-4"})})]})]})},s.id))})}),g&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:m?"Edit User":"Create User"}),e.jsx("button",{onClick:()=>l(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(C,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:w(E),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name"}),e.jsx("input",{...t("memberName"),type:"text",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500"}),r.memberName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.memberName.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("input",{...t("memberEmail"),type:"email",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500"}),r.memberEmail&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.memberEmail.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone (Optional)"}),e.jsx("input",{...t("memberPhone"),type:"tel",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500"}),r.memberPhone&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.memberPhone.message})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Family Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Adults"}),e.jsx("input",{...t("adults",{valueAsNumber:!0}),type:"number",min:"1",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500"}),r.adults&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.adults.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Children (5-13)"}),e.jsx("input",{...t("children",{valueAsNumber:!0}),type:"number",min:"0",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500"}),r.children&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.children.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Infants (0-5)"}),e.jsx("input",{...t("infants",{valueAsNumber:!0}),type:"number",min:"0",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500"}),r.infants&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.infants.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Elders (60+)"}),e.jsx("input",{...t("elder",{valueAsNumber:!0}),type:"number",min:"0",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500"}),r.elder&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.elder.message})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Role"}),e.jsxs("select",{...t("role"),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"MEMBER",children:"Member"}),e.jsx("option",{value:"ADMIN",children:"Admin"})]}),r.role&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.role.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Password ",m&&"(Leave blank to keep current)"]}),e.jsx("input",{...t("password"),type:"password",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-red-500 focus:border-red-500"}),r.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.password.message})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>l(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:b.isPending||h.isPending,className:"px-4 py-2 bg-red-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-red-700 disabled:opacity-50",children:b.isPending||h.isPending?"Saving...":m?"Update":"Create"})]})]})]})})]})})};export{J as component};
